# Παράλληλη Επεξεργασία   ![semester](https://img.shields.io/badge/Spring%20Semester-2017--2018-green.svg)

Εργασία Εξαμήνου στο μάθημα της Παράλληλης Επεξεργασίας

> **Ερώτημα 1b:** Σε ότι αφορά την αναδιοργάνωση του κώδικα, σωστά έχετε καταλάβει οι περισσότεροι πως αφορά το κομμάτι του αθροίσματος στην σχέση υπολογισμού του νέου δυναμικού ενός νευρώνα, καθώς εκεί εντοπίζονται οι περισσότερες πράξεις. Συγκεκριμένα, το άθροισμα αυτό για τον νευρώνα i είναι της μορφής Σσij * [uj(t) - ui(t)], όπου το άθροισμα εφαρμόζεται πάνω σε όλους τους γείτονες j του συγκεκριμένου νευρώνα. Επίσης σωστά έχετε καταλάβει οι περισσότεροι και έχουμε αναφέρει στο τελευταίο μάθημα  πως η βελτιστοποίηση θα ξεκινήσει χωρίζοντας το άθροισμα σε 2 επιμέρους αθροίσματα: Σσij * uj(t) - Σσij * ui(t). Το ερώτημα 1b αφορά την βελιστοποίηση του δεύτερου αθροίσματος. Παρατηρήστε πως σε δεδομένη χρονική στιγμή t το δυναμικό ui(t) του νευρώνα είναι σταθερό. Πως θα το εκμεταλλευτείτε αυτό στο δεύτερο άθροισμα; Επιπλέον ο πίνακας σ παραμένει σταθερός καθ' όλη την διάρκεια εκτέλεσης του προγράμματος. Αφού εκμεταλλευτείτε το γεγονός πως το ui(t) είναι σταθερό την χρονική στιγμή t, τι μπορείτε να προϋπολογίσετε με την έναρξη του προγράμματος και μετά απλά να χρησιμοποιείτε την υπολογισμένη τιμή για κάθε νευρώνα;
>
> **Ερώτημα 1c:** Το ερώτημα αυτό αφορά το πρώτο άθροισμα που προέκυψε από το παραπάνω βήμα. Παρατηρήστε πως για κάθε νευρώνα i λαμβάνουμε υπόψη μας το "βάρος" της σύνδεσης του με κάθε γείτονα j και υπολογίζουμε ένα άθροισμα γινομένων. Αν λάβετε υπόψη σας πως αυτό γίνεται για κάθε νευρώνα i (κάθε γραμμή του πίνακα σ) και κάθε γείτονα του (κάθε στήλη εντός της γραμμής i) που καταλήγετε ως προς το τι πράξη γίνεται τελικά μεταξύ του πίνακα σ και του διανύσματος u; Ποιο/ποια loop του αρχικού προγράμματος πρέπει να αντικατασταθούν από την κατάλληλη κλήση βιβλιοθήκης BLAS για την πραγματοποίηση της πράξης αυτής;

### Μεταγλώττιση σειριακού προγράμματος

Για την μεταγλώττιση του σειριακού προγράμματος η βασική εντολή είναι η εξής:

```sh
gcc -O0 -Wall -Wextra lif1d.c -ο lif1d
#or
gcc -O3 -Wall -Wextra lif1d.c -ο lif1d
```

### Προσθήκη βιβλιοθήκης BLAS

```sh
#include <cblas.h> // provides cblas functions
gcc -O3 -Wall -Wextra lif1d.c -ο lif1d -lblas # -L/path/to/lib (optional)
```

> Όλες οι διανομές Linux έχουν έτοιμα προς εγκατάσταση πακέτα για την βιβλιοθήκη BLAS. Π.χ. στα Ubuntu ένα τέτοιο πακέτο είναι το libblas-dev. Όπως μπορείτε εύκολα να επιβεβαιώσετε μέσω της ιστοσελίδας https://packages.ubuntu.com, το αρχείο επικεφαλίδων (header file) που εγκαθίσταται με αυτό το πακέτο είναι το cblas.h. Κατά συνέπεια, κατά την ανάπτυξη του κώδικα σας θα χρειαστεί να κάνετε include το παραπάνω αρχείο. Αντίστοιχο αρχείο θα υπάρχει και θα πρέπει να χρησιμοποιήσετε αν εγκαταστήσετε άλλη υλοποίηση των συναρτήσεων BLAS (π.χ. βιβλιοθήκη MKL της Intel).
>
> Κατά την μετάφραση του προγράμματος, το τελευταίο στάδιο είναι η σύνδεση (linking) του προγράμματος με τις βιβλιοθήκες που πρέπει να χρησιμοποιηθούν. Με απλά λόγια, ο μεταφραστής κάπου πρέπει να βρει τον εκτελέσιμο κώδικα των συναρτήσεων που καλείτε στο πρόγραμμα σας, αλλά δεν έχετε υλοποιήσει οι ίδιοι. Θα πρέπει να χρησιμοποιήσετε την παράμετρο -l του gcc για να δηλώσετε ποιες βιβλιοθήκες πρέπει να συνδεθούν και (αν χρειαστεί) την παράμετρο -L για να δηλώστε τους καταλόγους στους οποίους θα βρεθούν οι βιβλιοθήκες αυτές. Π.χ. για το παραπάνω πακέτο βλέπουμε πως οι βιβλιοθήκες που εγκαθίστανται είναι οι libblas.a (στατική βιβλιοθήκη) και libblas.so (δυναμική βιβλιοθήκη). Επομένως, η μετάφραση του προγράμματος σας θα πρέπει να γίνει ως εξής:
>
> gcc -O3 -o lif1d lif1d.c -lblas
>
> Προσέξτε πως από το όνομα της βιβλιοθήκης αφαιρούμε το πρόθεμα lib και την επέκταση (.a ή .so). Κατά την σύνδεση ελέγχονται συγκεκριμένοι κατάλογοι του συστήματος για να βρεθεί μια βιβλιοθήκη η χρήση της οποίας ζητήθηκε. Αν η βιβλιοθήκη δεν βρεθεί σε αυτούς τους προκαθορισμένους καταλόγους, τότε πρέπει να χρησιμοποιήσουμε επιπλέον την παράμετρο -L του gcc για να δηλώσουμε επιπλέον καταλόγους στους οποίους πρέπει να γίνει η αναζήτηση. Λογικά στην περίπτωση της BLAS δεν θα χρειαστεί κάτι τέτοιο. Αν χρειαστεί, και πάλι μέσω της παραπάνω ιστοσελίδας, βλέπουμε πως η βιβλιοθήκη BLAS έχει εγκατασταθεί στον κατάλογο /usr/lib/libblas. Κατά συνέπεια, η μετάφραση του προγράμματος σας θα πρέπει να γίνει με την εντολή:
>
> gcc -O3 -o lif1d lif1d.c -L/usr/lib/libblas -lblas
